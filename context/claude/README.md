# Claude Code Documentation

This directory contains guides for Claude Code sessions working with the Your Site website.

## Quick Start

**What kind of task are you doing?**

| Task | Guide |
|------|-------|
| Create a new page | [creating-pages.md](creating-pages.md) |
| Update an existing page | [updating-pages.md](updating-pages.md) |
| Work with Enfold shortcodes | [enfold-shortcodes.md](enfold-shortcodes.md) |
| Change site colors/fonts/branding | [theme-customization.md](theme-customization.md) |
| Fix a deployment issue | [troubleshooting.md](troubleshooting.md) |

## Design Tokens

**Before creating content, load the brand colors:**

```bash
cat theme/design-tokens.json
```

This file contains the official color palette, fonts, and assets. Use the color set classes (`main_color`, `alternate_color`) rather than hardcoded hex values. See [theme-customization.md](theme-customization.md) for details.

## Critical Rules

> ⚠️ **Never manually create meta JSON files.** They are auto-generated by GitHub Actions. Manually created meta files cause deployment failures.

> ⚠️ **Always test on staging first.** Push to `staging` branch, verify, then merge to `main`.

> ⚠️ **Never edit generated theme files.** Edit `theme/design-tokens.json` only - the full settings are auto-generated.

## System Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                        GitOps Workflow                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  content/pages/*.txt  ──push──▶  GitHub Actions  ──REST──▶  WP │
│         │                              │                        │
│         │                              ▼                        │
│         │                     meta/pages/*.json                 │
│         │                     (auto-generated)                  │
│         │                                                       │
│  New files → create-wordpress-resource.sh → Creates in WP      │
│  Existing → deploy-content.sh → Updates in WP                  │
│                                                                 │
│  theme/design-tokens.json ─▶ generate-theme-settings.py        │
│                              ─▶ REST API ─▶ Enfold styling     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### How the workflow decides: New vs Update

| Condition | Action |
|-----------|--------|
| Content file exists, NO meta file | **CREATE** new page in WordPress |
| Content file exists, meta file exists with valid `post_id` | **UPDATE** existing page |
| Content file exists, meta file exists but invalid | **ERROR** - delete the meta file |

## Branches & Environments

| Branch | Environment | URL |
|--------|-------------|-----|
| `staging` | Staging | https://staging.example.com |
| `main` | Production | https://example.com |

**Always test on staging first!**

## Key Directories

```
├── content/
│   ├── pages/          # Page content (Enfold shortcodes)
│   ├── posts/          # Blog posts
│   ├── portfolio/      # Portfolio items
│   └── layouts/        # Enfold layouts
├── theme/
│   └── design-tokens.json  # Brand colors, fonts, assets (EDITABLE)
├── meta/                # ⚠️ AUTO-GENERATED - Do not manually create!
│   ├── pages/          # Page metadata (auto-generated)
│   └── ...             # Other content type metadata
├── scripts/
│   ├── create-wordpress-resource.sh  # Creates new WP resources
│   ├── deploy-content.sh             # Updates existing resources
│   ├── generate-theme-settings.py    # Generates Enfold settings
│   └── deploy-page.sh                # Legacy page deploy
├── wordpress/
│   └── plugins/        # Required WordPress plugins
└── claude/             # This documentation
```

## Content File Formats

### New Pages (with YAML frontmatter)

```txt
---
title: Page Title
slug: page-slug
status: publish
---
[av_section]...[/av_section]
```

### Existing Pages (no frontmatter)

Just Enfold shortcode content - metadata is in `meta/pages/<n>.json`.

## Common Commands

```bash
# Test on staging
git checkout staging
git pull origin staging
# ... make changes to content files only ...
git add content/
git commit -m "Your message"
git push origin staging

# Promote to production
git checkout main
git merge staging
git push origin main
```

## What NOT to Do

```bash
# ❌ NEVER manually create meta files
echo '{"post_id": 123}' > meta/pages/new-page.json

# ❌ NEVER commit meta files for new pages
git add meta/pages/new-page.json

# ❌ NEVER push directly to main without testing
git push origin main  # Test on staging first!

# ❌ NEVER edit the generated Enfold settings file
# Edit theme/design-tokens.json instead
```
